{% extends "base.html" %}
{% block title %}Reportes - Yard Gate Álamo{% endblock %}
{% block content %}
<h2>Reportes</h2>

<div class="card" style="max-width:1000px;">
  <form method="get" action="{{ url_for('yard.reports_run') }}">
    <label>Tipo de reporte</label>
    <select name="movement_type">
      <option value="" {% if not movement_type %}selected{% endif %}>Todos (Gate In / Gate Out / Moves)</option>
      <option value="GATE_IN" {% if movement_type == "GATE_IN" %}selected{% endif %}>Solo Gate In</option>
      <option value="GATE_OUT" {% if movement_type == "GATE_OUT" %}selected{% endif %}>Solo Gate Out</option>
      <option value="MOVE" {% if movement_type == "MOVE" %}selected{% endif %}>Solo Movimientos (Mapa)</option>
    </select>

    <label>Desde</label>
    <input type="date" name="date_from" value="{{ date_from or '' }}" required>

    <label>Hasta</label>
    <input type="date" name="date_to" value="{{ date_to or '' }}" required>

    <button type="submit">Generar</button>
  </form>
</div>

{% if rows is not none %}
<div class="card" style="max-width:1000px; margin-top:16px;">
  <div style="display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;">
    <h3 style="margin:0;">Resultados</h3>
    <div style="font-size:12px; color:#555;">
      {% if date_from and date_to %}
        Rango: <b>{{ date_from }}</b> a <b>{{ date_to }}</b>
      {% endif %}
      {% if movement_type %}
        · Tipo: <b>{{ movement_type }}</b>
      {% endif %}
    </div>
  </div>

  <div style="overflow:auto; margin-top:10px;">
    <table style="width:100%; min-width:860px; border-collapse:collapse;">
      <thead>
        <tr>
          <th style="text-align:left; padding:8px; border-bottom:1px solid #ddd;">Fecha/Hora</th>
          <th style="text-align:left; padding:8px; border-bottom:1px solid #ddd;">Movimiento</th>
          <th style="text-align:left; padding:8px; border-bottom:1px solid #ddd;">Contenedor</th>
          <th style="text-align:left; padding:8px; border-bottom:1px solid #ddd;">Ubicación</th>
          <th style="text-align:left; padding:8px; border-bottom:1px solid #ddd;">Chofer / Placa</th>
        </tr>
      </thead>
      <tbody>
        {% for mv, c in rows %}
        <tr>
          <td style="padding:8px; border-bottom:1px solid #eee;">{{ mv.occurred_at }}</td>
          <td style="padding:8px; border-bottom:1px solid #eee;">{{ mv.movement_type }}</td>
          <td style="padding:8px; border-bottom:1px solid #eee;">{{ c.code }}</td>
          <td style="padding:8px; border-bottom:1px solid #eee;">
            {% if mv.bay_code %}
              {{ mv.bay_code }}
              {% if mv.depth_row %} F{{ "%02d"|format(mv.depth_row) }}{% endif %}
              {% if mv.tier %} N{{ mv.tier }}{% endif %}
            {% else %}
              -
            {% endif %}
          </td>
          <td style="padding:8px; border-bottom:1px solid #eee;">
            {{ (mv.driver_name or "-") }} / {{ (mv.truck_plate or "-") }}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% if rows|length == 0 %}
    <div class="flash info" style="margin-top:12px;">No hay movimientos en ese rango / filtro.</div>
  {% endif %}
</div>
{% endif %}
{% endblock %}


