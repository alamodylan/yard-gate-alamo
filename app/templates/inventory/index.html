{# app/templates/inventory/index.html #}
{% extends "base.html" %}
{% block title %}Inventario | Yard Gate Álamo{% endblock %}

{% block content %}
  <div class="card card-pad" style="margin-bottom:14px;">
    <div style="display:flex; justify-content:space-between; align-items:flex-start; gap:12px; flex-wrap:wrap;">
      <div>
        <h2 style="margin:0;">Inventario de Contenedores</h2>
        <p class="card-sub" style="margin-top:6px;">Listado general con filtro y acceso a detalle con fotos y movimientos.</p>
      </div>

      <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
        <a class="btn" href="{{ url_for('inventory.inventory_export', in_yard=in_yard, q=q) }}" title="Exportar respetando filtros">
          ⬇ Exportar Excel
        </a>
      </div>
    </div>

    <form method="get" style="margin-top:12px;">
      <div style="display:flex; gap:10px; align-items:end; flex-wrap:wrap;">
        <div style="min-width:260px; flex:1;">
          <label style="margin-top:0;">Buscar por código</label>
          <input class="input" type="text" name="q" value="{{ q or '' }}" placeholder="Ej: MSCU-123456-7">
        </div>

        <div style="min-width:220px;">
          <label style="margin-top:0;">Filtro</label>
          <select class="select" name="in_yard">
            <option value="" {% if not in_yard %}selected{% endif %}>Todos</option>
            <option value="1" {% if in_yard == "1" %}selected{% endif %}>Solo en patio</option>
            <option value="0" {% if in_yard == "0" %}selected{% endif %}>Solo fuera de patio</option>
          </select>
        </div>

        <div style="display:flex; gap:10px; align-items:center;">
          <button class="btn primary" type="submit">Filtrar</button>

          {% if in_yard or q %}
            <a class="btn" href="{{ url_for('inventory.inventory_index') }}">Limpiar</a>
          {% endif %}
        </div>
      </div>

      <div class="hint" style="margin-top:10px;">
        Tip: el Excel se genera con exactamente el mismo filtro que ves en pantalla.
      </div>
    </form>
  </div>

  <div class="card" style="overflow:auto;">
    <table class="table" style="min-width:980px;">
      <thead>
        <tr>
          <th>Contenedor</th>
          <th>Tamaño</th>
          <th>Año</th>
          <th>En patio</th>
          <th>Posición</th>
          <th>Notas</th>
          <th style="width:110px;">Acción</th>
        </tr>
      </thead>

      <tbody>
        {% for it in items %}
          <tr>
            <td style="font-weight:900;">
              <a href="{{ url_for('inventory.inventory_detail', container_id=it.id) }}" style="text-decoration:none;">
                {{ it.code }}
              </a>
            </td>
            <td>{{ it.size }}</td>
            <td>{{ it.year or "" }}</td>
            <td>
              {% if it.is_in_yard %}
                <span class="badge success">Sí</span>
              {% else %}
                <span class="badge muted">No</span>
              {% endif %}
            </td>
            <td>
              {% if it.position %}
                <span class="badge">
                  {{ it.position.bay_code }}
                  · F{{ "%02d"|format(it.position.depth_row) }}
                  · N{{ it.position.tier }}
                </span>
              {% else %}
                —
              {% endif %}
            </td>
            <td style="color:rgba(229,231,235,.85);">
              {{ it.status_notes or "" }}
            </td>
            <td>
              <a class="btn" href="{{ url_for('inventory.inventory_detail', container_id=it.id) }}">Ver</a>
            </td>
          </tr>
        {% endfor %}

        {% if not items %}
          <tr>
            <td colspan="7" style="color:rgba(229,231,235,.80);">
              No hay registros con ese filtro.
            </td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
{% endblock %}



